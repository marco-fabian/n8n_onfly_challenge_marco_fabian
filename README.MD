# n8n Random Node - Custom Connector

Este projeto implementa um conector personalizado para n8n que gera nÃºmeros aleatÃ³rios usando a API do Random.org.

## ğŸ¯ Objetivo

Criar um conector personalizado para n8n com:
- **Nome**: Random
- **OperaÃ§Ã£o**: "True Random Number Generator"
- **Inputs**: Min e Max (nÃºmeros inteiros inclusos)
- **IntegraÃ§Ã£o**: API do Random.org com fallback local

## ğŸ“ Estrutura do Projeto

```
n8n_onfly_challenge_marco_fabian/
â”œâ”€â”€ n8n-infra/                    # Infraestrutura Docker
â”‚   â”œâ”€â”€ docker-compose.yml        # ConfiguraÃ§Ã£o n8n + PostgreSQL
â”‚   â”œâ”€â”€ .env.example             # VariÃ¡veis de ambiente exemplo
â”‚   â””â”€â”€ .env                     # VariÃ¡veis de ambiente (nÃ£o versionado)
â”œâ”€â”€ n8n-node-random/             # Custom Node
â”‚   â”œâ”€â”€ src/nodes/Random/        # CÃ³digo fonte TypeScript
â”‚   â”‚   â”œâ”€â”€ Random.node.ts       # ImplementaÃ§Ã£o do nÃ³
â”‚   â”‚   â””â”€â”€ random.svg           # Ãcone do nÃ³
â”‚   â”œâ”€â”€ dist/                    # CÃ³digo compilado (gerado automaticamente)
â”‚   â”œâ”€â”€ package.json             # ConfiguraÃ§Ã£o do pacote
â”‚   â””â”€â”€ tsconfig.json            # ConfiguraÃ§Ã£o TypeScript
â””â”€â”€ README.md                    # Este arquivo
```

## ğŸš€ Como Executar

### PrÃ©-requisitos

- **Node.js 22+** (LTS)
- **Docker Desktop** instalado e rodando
- **Git**

### 1. Instalar DependÃªncias

```bash
# Clone o repositÃ³rio
git clone https://github.com/marco-fabian/n8n_onfly_challenge_marco_fabian.git
cd n8n_onfly_challenge_marco_fabian

# Instalar dependÃªncias do custom node
cd n8n-node-random
npm install
```

### 2. Compilar o Custom Node

```bash
# Compilar TypeScript para JavaScript
npm run build
```

### 3. Configurar Ambiente

```bash
# Copiar arquivo de exemplo
cd ../n8n-infra
cp .env.example .env
```

**Arquivo .env criado:**
```env
POSTGRES_USER=n8n
POSTGRES_PASSWORD=sua_senha_do_db_aqui
POSTGRES_DB=n8n

N8N_ENCRYPTION_KEY=sua_senha_aqui
```

### 4. Executar ServiÃ§os

```bash
# Subir n8n + PostgreSQL
docker compose up -d
```

### 5. Acessar n8n

Abra seu navegador em: **http://localhost:5678**

## ğŸ§ª Testando o Custom Node

1. **Criar novo workflow** no n8n
2. **Procurar por "Random"** na categoria "Transform"
3. **Configurar campos**:
   - Min: valor mÃ­nimo (ex: 1)
   - Max: valor mÃ¡ximo (ex: 100)
4. **Executar** o workflow
5. **Verificar resultado** com nÃºmero aleatÃ³rio gerado

## ğŸ”§ Funcionalidades

### IntegraÃ§Ã£o com Random.org
- Utiliza a API oficial: `https://www.random.org/integers/`
- ParÃ¢metros: `num=1&min={min}&max={max}&col=1&base=10&format=plain&rnd=new`

### Fallback Local
- Se a API do Random.org falhar, usa geraÃ§Ã£o local
- Garante que o nÃ³ sempre funcione

### Tratamento de Erro
- Try/catch para capturar erros da API
- Logs informativos sobre a fonte do nÃºmero


## ğŸ› ï¸ Desenvolvimento

### Estrutura do CÃ³digo

```typescript
// Random.node.ts
export class Random implements INodeType {
  description: INodeTypeDescription = {
    displayName: 'Random',
    name: 'random',
    icon: 'file:random.svg',
    // ... configuraÃ§Ã£o da UI
  };

  async execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {
    // LÃ³gica de execuÃ§Ã£o com API Random.org
  }
}
```

### CompilaÃ§Ã£o

```bash
# Desenvolvimento (watch mode)
npm run dev

# ProduÃ§Ã£o
npm run build
```

## ğŸ“ Logs e Debug

```bash
# Ver logs do n8n
cd n8n-infra
docker compose logs n8n

# Ver logs do PostgreSQL
docker compose logs postgres

# Status dos containers
docker compose ps
```

## ğŸ”„ AtualizaÃ§Ãµes

Para atualizar o custom node apÃ³s mudanÃ§as:

1. Compile o cÃ³digo: `npm run build`
2. Copie o SVG: `cp src/nodes/Random/random.svg dist/nodes/Random/`
3. Reinicie o n8n: `docker compose restart n8n`

## ğŸ“ Suporte

- **Autor**: Marco Fabian
- **RepositÃ³rio**: https://github.com/marco-fabian/n8n_onfly_challenge_marco_fabian
- **DocumentaÃ§Ã£o n8n**:
https://docs.n8n.io/hosting/installation/docker/
https://docs.n8n.io/integrations/creating-nodes/
https://docs.n8n.io/integrations/creating-nodes/test/run-node-locally/

## ğŸ”§ Troubleshooting

### Problema: Erro de compilaÃ§Ã£o TypeScript
```bash
# SoluÃ§Ã£o: Reinstalar dependÃªncias
cd n8n-node-random
rm -rf node_modules package-lock.json
npm install
npm run build
```

### Problema: SVG nÃ£o aparece no n8n
```bash
# SoluÃ§Ã£o: Verificar se o SVG estÃ¡ na pasta dist
ls dist/nodes/Random/random.svg
# Se nÃ£o estiver, copiar manualmente:
cp src/nodes/Random/random.svg dist/nodes/Random/
```

### Problema: n8n nÃ£o reconhece o custom node
```bash
# SoluÃ§Ã£o: Verificar se o arquivo compilado existe
ls dist/nodes/Random/Random.node.js
# Se nÃ£o existir, compilar novamente:
npm run build
```

## ğŸ“„ LicenÃ§a

MIT License 